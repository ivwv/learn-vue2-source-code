{"version":3,"file":"vue.js","sources":["../src/observe/arr.js","../src/observe/index.js","../src/initState.js","../src/init.js","../src/index.js"],"sourcesContent":["// （1）重写数组的 push() 函数\r\nlet oldArrayProtoMethods = Array.prototype\r\n\r\n// （2）继承\r\nexport let ArrayMethods = Object.create(oldArrayProtoMethods)\r\n\r\n// (3) 劫持\r\nlet methods = ['push', 'pop', 'unshift', 'shift', 'slice']\r\n\r\nmethods.forEach((item) => {\r\n  ArrayMethods[item] = function (...args) {\r\n    // {list:[]}\r\n    // console.log('劫持数组')\r\n    // 通过 aldArr.apply(this,args) 劫持旧的数组方法 ，改变旧的数组方法为当前的新数组方法\r\n    let result = oldArrayProtoMethods[item].apply(this, args)\r\n    // console.log(args)\r\n    // 数组追加对象的情况 要进行劫持  arr.push({a:1})   arr.unsfift\r\n    let inserted\r\n    switch (item) {\r\n      case 'push':\r\n      case 'unshift':\r\n        inserted = args\r\n        break\r\n      case 'splice':\r\n        inserted = args.splice(2) // arr.splice(0,1,{a:6})\r\n    }\r\n    // console.log(inserted)\r\n    let ob = this.__ob__ // 得到\r\n    // 判断\r\n    if (inserted) {\r\n      ob.observerArray(inserted) //对我们添加的对象进行劫持\r\n    }\r\n\r\n    return result\r\n  }\r\n})\r\n","import { ArrayMethods } from './arr'\r\n\r\nexport function observer(data) {\r\n  //   console.log(data)\r\n  // 给 value 定义一个属性\r\n\r\n  // 1.判断\r\n  if (typeof data != 'object' || data == null) {\r\n    return data\r\n  }\r\n  //   是对象的形式\r\n  return new Observer(data)\r\n}\r\nclass Observer {\r\n  constructor(value) {\r\n    Object.defineProperty(value, '__ob__', {\r\n      enumersble: false,\r\n      value: this,\r\n    })\r\n    // 判断数据\r\n    // console.log(value)\r\n    if (Array.isArray(value)) {\r\n      // 数组给数组的原型添加重写数组的方法\r\n      value.__proto__ = ArrayMethods\r\n      // console.log('数组')\r\n      // 如果是数组对象\r\n      //处理数组对象的劫持\r\n      this.observerArray(value)\r\n    } else {\r\n      this.walk(value) // 遍历\r\n    }\r\n  }\r\n  walk(data) {\r\n    let keys = Object.keys(data)\r\n    for (let i = 0; i < keys.length; i++) {\r\n      //将每一个数据拿出来 对每一个属性进行劫持\r\n      let key = keys[i] //data每一个键\r\n      let value = data[key] //通过键获取每一个值\r\n      //   数据劫持方法\r\n      defineReactive(data, key, value)\r\n    }\r\n  }\r\n  // 解决数组内队对象形式\r\n  // [{a:1}]\r\n  observerArray(value) {\r\n    for (let i = 0; i < value.length; i++) {\r\n      observer(value[i])\r\n    }\r\n  }\r\n}\r\n\r\n// 对对象中的属性进行劫持\r\nfunction defineReactive(data, key, value) {\r\n  //{a:{b:1}}\r\n  /**\r\n   * 问题一\r\n   * 由于 Object.defineProperty() 只能代理第一层的数据,只能对对象中的一个属性进行劫持\r\n   * 假如对象内还嵌套了一层对象，这不能代理\r\n   * 此时需要进行递归代理\r\n   * 由于 该文件内 的 observer() 方法 传递的是一个data 对象\r\n   * 此方法内的value也是传递过来的对象，所以可以将 value 传递过来再调用 observer() 方法\r\n   *\r\n   */\r\n  // 深度代理 递归\r\n  observer(value)\r\n\r\n  Object.defineProperty(data, key, {\r\n    // 获取触发\r\n    get() {\r\n      // console.log('获取')\r\n      return value\r\n    },\r\n    // 设置触发\r\n    set(newValue) {\r\n      // console.log('设置值')\r\n      // 判断新值是否和旧值一样 ，一样就返回\r\n      if (newValue == value) return\r\n      /**\r\n       * 问题二\r\n       * 当修改为对象时，再调用 observer() 方法进行新对象代理\r\n       */\r\n      observer(newValue) // 如果用户设置的值是对象就进行递归\r\n      value = newValue\r\n    },\r\n  })\r\n}\r\n\r\n// vue2  Object.defineProperty 缺点 对象中的一个属性进行劫持 {a:1,b:2}\r\n\r\n// 数组形式 {list:[1,2,3,4],arr:[{a:1}]}\r\n// 方法函数劫持 , 重写数组方法 arr.push()  就是对 arr.push()经行劫持\r\n","import { observer } from './observe/index.js'\r\n\r\nexport function initState(vm) {\r\n  let opts = vm.$options\r\n  // console.log(opts)\r\n  //   判断\r\n  if (opts.props) {\r\n    initProps(vm)\r\n  }\r\n  if (opts.data) {\r\n    initData(vm)\r\n  }\r\n  if (opts.watch) {\r\n    initWatch(vm)\r\n  }\r\n  if (opts.computed) {\r\n    initComputed(vm)\r\n  }\r\n  if (opts.methods) {\r\n    initMethods(vm)\r\n  }\r\n}\r\n\r\nfunction initComputed(vm) {}\r\nfunction initMethods(vm) {}\r\nfunction initProps(vm) {}\r\nfunction initWatch(vm) {}\r\n\r\n// 对data进行初始化\r\nfunction initData(vm) {\r\n  // console.log('data初始化')\r\n  let data = vm.$options.data\r\n  data = vm._data = typeof data === 'function' ? data.call(vm) : data\r\n  // console.log(data)\r\n\r\n  // 将 data上的说所有属性代理到 实例上 {a:1,b:2}\r\n  for (let key in data) {\r\n    proxy(vm, '_data', key)\r\n  }\r\n\r\n  // 对数据进行劫持\r\n  observer(data)\r\n}\r\n\r\nfunction proxy(vm, source, key) {\r\n  Object.defineProperty(vm, key, {\r\n    get() {\r\n      // console.log('proxy-get')\r\n      return vm[source][key]\r\n    },\r\n    set(newValue) {\r\n      // console.log('proxy-set')\r\n      vm[source][key] = newValue\r\n    },\r\n  })\r\n}\r\n","import { initState } from './initState'\r\n\r\nexport function initMixin(Vue) {\r\n  Vue.prototype._init = function (options) {\r\n    // console.log(options)\r\n    let vm = this\r\n    vm.$options = options\r\n    // 初始化状态\r\n    initState(vm)\r\n  }\r\n}\r\n","import { initMixin } from './init'\r\n\r\nfunction Vue(options) {\r\n  //   console.log(options);\r\n  //   初始化\r\n  this._init(options)\r\n}\r\n\r\ninitMixin(Vue)\r\n\r\nexport default Vue\r\n"],"names":[],"mappings":"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"}